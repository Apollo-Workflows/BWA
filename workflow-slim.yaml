---
name: "BWA"
dataIns:
- name: "s3bucket"
  type: "string"
  source: "s3bucket"
- name: "file_reference"
  type: "string"
  source: "file_reference"
- name: "file_r1"
  type: "string"
  source: "file_r1"
- name: "file_r2"
  type: "string"
  source: "file_r2"
- name: "numSplits"
  type: "number"
  source: "numSplits"
workflowBody:
- function:
    name: "bwa-split"
    type: "Collection"
    dataIns:
    - name: "s3bucket"
      type: "string"
      source: "BWA/s3bucket"
    - name: "numSplits"
      type: "number"
      source: "BWA/numSplits"
    - name: "file_r1"
      type: "string"
      source: "BWA/file_r1"
    - name: "file_r2"
      type: "string"
      source: "BWA/file_r2"
    dataOuts:
    - name: "s3mainprefix"
      type: "string"
    - name: "s3prefixes"
      type: "collection"
    - name: "r1s3keys"
      type: "collection"
    - name: "r2s3keys"
      type: "collection"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-central-1:735406098573:function:bwa-split"
- function:
    name: "bwa-index"
    type: "collection"
    dataIns:
    - name: "s3bucket"
      type: "string"
      source: "BWA/s3bucket"
    - name: "s3mainprefix"
      type: "string"
      source: "bwa-split/s3mainprefix"
    - name: "file_reference"
      type: "string"
      source: "BWA/file_reference"
    dataOuts:
    - name: "file_amb"
      type: "string"
    - name: "file_ann"
      type: "string"
    - name: "file_bwt"
      type: "string"
    - name: "file_pac"
      type: "string"
    - name: "file_sa"
      type: "string"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-central-1:735406098573:function:bwa-index"
- parallelFor:
    name: "ParallelFor"
    dataIns:
    - name: "file_reference"
      type: "string"
      source: "BWA/file_reference"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "s3prefix"
      type: "string"
      source: "bwa-split/s3prefixes"
      constraints:
      - name: "distribution"
        value: "BLOCK(1)"
    - name: "file_amb"
      type: "string"
      source: "bwa-index/file_amb"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "file_ann"
      type: "string"
      source: "bwa-index/file_ann"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "file_bwt"
      type: "string"
      source: "bwa-index/file_bwt"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "file_pac"
      type: "string"
      source: "bwa-index/file_pac"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "file_sa"
      type: "string"
      source: "bwa-index/file_sa"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "r1s3key"
      type: "string"
      source: "bwa-split/r1s3keys"
      constraints:
      - name: "distribution"
        value: "BLOCK(1)"
    - name: "r2s3key"
      type: "string"
      source: "bwa-split/r2s3keys"
      constraints:
      - name: "distribution"
        value: "BLOCK(1)"
    - name: "s3mainprefix"
      type: "string"
      source: "bwa-split/s3mainprefix"
    loopCounter:
      type: "number"
      to: "BWA/numSplits"
      step: "1"
    loopBody:
    - function:
        name: "bwa-aln"
        type: "Collection"
        dataIns:
        - name: "file_reference"
          type: "string"
          source: "ParallelFor/file_reference"
        - name: "file_amb"
          type: "string"
          source: "ParallelFor/file_amb"
        - name: "file_ann"
          type: "string"
          source: "ParallelFor/file_ann"
        - name: "file_bwt"
          type: "string"
          source: "ParallelFor/file_bwt"
        - name: "file_pac"
          type: "string"
          source: "ParallelFor/file_pac"
        - name: "file_sa"
          type: "string"
          source: "ParallelFor/file_sa"
        - name: "s3prefix"
          type: "string"
          source: "ParallelFor/s3prefix"
        - name: "r1s3key"
          type: "string"
          source: "ParallelFor/r1s3key"
        - name: "r2s3key"
          type: "string"
          source: "ParallelFor/r2s3key"
        - name: "s3bucket"
          type: "string"
          source: "ParallelFor/s3bucket"
        - name: "s3mainprefix"
          type: "string"
          source: "ParallelFor/s3mainprefix"
        dataOuts:
        - name: "sai1s3key"
          type: "string"
        - name: "sai2s3key"
          type: "string"
        properties:
        - name: "resource"
          value: "arn:aws:lambda:eu-central-1:735406098573:function:bwa-aln"
    - function:
        name: "bwa-sampe"
        type: "Collection"
        dataIns:
        - name: "file_reference"
          type: "string"
          source: "ParallelFor/file_reference"
        - name: "file_amb"
          type: "string"
          source: "ParallelFor/file_amb"
        - name: "file_ann"
          type: "string"
          source: "ParallelFor/file_ann"
        - name: "file_bwt"
          type: "string"
          source: "ParallelFor/file_bwt"
        - name: "file_pac"
          type: "string"
          source: "ParallelFor/file_pac"
        - name: "file_sa"
          type: "string"
          source: "ParallelFor/file_sa"
        - name: "s3bucket"
          type: "string"
          source: "ParallelFor/s3bucket"
        - name: "r1s3key"
          type: "string"
          source: "ParallelFor/r1s3key"
        - name: "r2s3key"
          type: "string"
          source: "ParallelFor/r2s3key"
        - name: "sai1s3key"
          type: "string"
          source: "bwa-aln/sai1s3key"
        - name: "sai2s3key"
          type: "string"
          source: "bwa-aln/sai2s3key"
        - name: "s3prefix "
          type: "string"
          source: "ParallelFor/s3prefix"
        - name: "s3mainprefix"
          type: "string"
          source: "ParallelFor/s3mainprefix"
        dataOuts:
        - name: "s3samkey"
          type: "string"
        properties:
        - name: "resource"
          value: "arn:aws:lambda:eu-central-1:735406098573:function:bwa-sampe"
    dataOuts:
    - name: "s3samkeys"
      type: "string"
      source: "bwa-sampe/s3samkey"
- function:
    name: "bwa-merge"
    type: "Collection"
    dataIns:
    - name: "s3bucket"
      type: "string"
      source: "BWA/s3bucket"
    - name: "s3samkeys"
      type: "collection"
      source: "ParallelFor/s3samkeys"
    dataOuts:
    - name: "mergedsamkey"
      type: "string"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-central-1:735406098573:function:bwa-merge"
dataOuts:
- name: "s3bucket"
  type: "string"
  source: "BWA/s3bucket"
- name: "mergedsamkey"
  type: "string"
  source: "bwa-merge/mergedsamkey"
